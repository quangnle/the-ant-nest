<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pattern Maker</title>

</head>

<body>
  <h1>Pattern Maker</h1>
  <div name="left-column" style="float: left; width: 450px;">
    <div id="sketch-holder">
      <canvas id="canvasArea"></canvas>
      <!-- color picker -->
      <input type="color" id="color-picker" onchange="updateColor();" value="#000000">
    </div>
  </div>
  <div name="right-column" style="float: left;">
    <ul style="list-style-type: none; margin-left: 0px; padding-left: 0px;">
      <li style="display: inline;"><input id="pattern-name" type="text" placeholder="pattern name"></li>
      <li style="display: inline;"><button class="btn" onclick="exportArray()">Export</button></li>
    </ul>
  </div>

  <script src="sketch.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.2/axios.min.js"></script>
  <script src="../utils/api.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js"
  integrity="sha512-eu9vkh+EbAsW3fMmPTj/DP5W3UegIdu0Z/OABMocvoofx43MYBkcQ9hRIVxZndV1vcCYQwBg+U1PkWl04TD0Jg=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    document.addEventListener('contextmenu', event => {
      event.preventDefault()
    });

    let pattern = [];
    let selectedColor = document.getElementById("color-picker").value;

    function updateColor() {
      selectedColor = document.getElementById("color-picker").value;
    }

    function generateDefaultPattern() {
      // get value of the pattern size
      const size = 20
        // generate 2d array with the size
        pattern = new Array(size);
      for (let i = 0; i < size; i++) {
        pattern[i] = new Array(size).fill(0);
      }

      const cx = pattern[0].length >> 1;
      const cy = pattern.length >> 1;
      const r = (pattern.length >> 1);
      for (let i = 0; i < pattern.length; i++) {
        for (let j = 0; j < pattern[i].length; j++) {
          let d = Math.floor(dist(j, i, cx, cy));
          if (d >= r) {
            pattern[i][j] = -1;
          }
        }
      }
    }

    function exportArray() {
      var code = document.getElementById("code");
      var patternName = document.getElementById("pattern-name").value;
      api.createAppearance({
        name: patternName,
        pattern
      }).then(({data}) => {
        if (data._id) {
          alert('Create Pattern success')
        }
      }).catch(error => {
          alert('Create Pattern failed, please try later')
      })
    }
  </script>
</body>

</html>