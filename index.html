<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bug Farm</title>
    <style>
        body {
            font-family: Calibri, sans-serif;
            font-size: 12px;
        }
        h4 {
            font-family: Calibri, sans-serif;
            font-size: 14px;
        }
        h5 {
            font-family: Calibri, sans-serif;
            font-size: 12px;
        }
        button {
            font-family: Calibri, sans-serif;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div style="display: flex; column-count: 2; column-gap: 0px;">
        <div name="game-area" style="float: left; width: auto;">            
            <div id="sketch-holder"><canvas id="main-canvas"></canvas></div>
            <p style="margin-bottom: 0; padding-bottom: 0;">Left click on a bug or a flower to select it. Right click in plant mode to plant a flower.</p>
        </div>
        <div name="control-area" style="float: left;">
            <ul style="padding: 0px; margin:0px;">
                <li style="display: block; background-color: aliceblue; width: 250px; margin-bottom: 3px;">
                    <h4 style="text-align: center; background-color: forestgreen; margin-top:0px; margin-bottom: 3px;">Player Info - Legos</h4>                
                    <ul style="list-style-type: none; padding-left: 10px;">
                        <li>Money: <span style="margin-right: 2px;">$100</span></li>
                        <li>Capacity: <span style="margin-right: 2px;">100</span></li>
                        <li>Food left: <span style="margin-right: 2px;">10</span></li>
                        <li>Population: <span style="margin-right: 2px;">1</span></li>
                    </ul>
                </li>
                <li style="display: block; background-color: aliceblue; width: 250px;  margin-bottom: 3px;">
                    <h4 style="text-align: center; background-color: forestgreen; padding: 0px;  margin-top:0px; margin-bottom: 3px;">Bug Info</h4>
                    <div style="float: left; width: 55px; padding:2px">
                        <canvas id="bug-pattern-canvas" width="50" height="50"></canvas>
                        <p id="bug-color-label" style="text-align:center"></p>
                    </div>
                    <div>
                        <ul style="list-style: none;">
                            <li style="display: block; text-align: right; padding-right: 20px;">Bug genes</li>
                            <li style="display: block;"><textarea id="bug-genes-info" readonly rows="10" cols="20"></textarea>    </li>
                        </ul>
                    </div>
                    <button id="kill-btn" style="margin-left: 2px;" onclick="sellABug()">Sell it</button>
                    <button id="bring-to-market">Bring it to the market</button>
                </li>
                <li style="display: block; background-color: aliceblue; width: 250px; margin-bottom: 3px;">
                    <h4 style="text-align: center; background-color: forestgreen; margin-top:0px; margin-bottom: 3px;">Flower Config</h4>
                    <ul style="list-style-type: none; padding: 5px;">
                        <li>Number of petals: <input type="number" id="petal-number" value="5" min="5" max="8" style="width: 25px;"></li>
                        <li>
                            <ul style="list-style-type: none; padding: 3px;">
                                <li style="display: inline;">Pistil Color: <input type="color" id="pistil-color" value="#ff0000" style="width: 35px;"></li>
                                <li style="display: inline;">Size: <input type="number" id="pistil-size" value="5" min="3" max="7" style="width: 25px;"></li>
                            </ul>
                        </li>
                        <li>
                            <ul style="list-style-type: none; padding: 3px;">
                                <li style="display: inline;">Petal Color: <input type="color" id="petal-color" value="#ffffff" style="width: 35px;"></li>
                                <li style="display: inline;">Size: <input type="number" id="petal-size" value="5" min="3" max="7" style="width: 25px;"></li>
                            </ul>
                        </li>
                    </ul>
                    <button id="remove-flower-btn" style="margin-left: 2px;" onclick="removeFlower()">Remove it</button>
                    <button id="plan-btn" style="margin-left: 2px;" onclick="plan()">Random plan a flower</button>                    
                </li>
            </ul>
        </div>        
    </div>

    <script src="patterns.js"></script>
    <script src="evolution.js"></script>
    <script src="bug.js"></script>
    <script src="flower.js"></script>
    <script src="farm.js"></script>    
    <script src="control-panel.js"></script>  
    <script src="sketch.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.min.js" integrity="sha512-eu9vkh+EbAsW3fMmPTj/DP5W3UegIdu0Z/OABMocvoofx43MYBkcQ9hRIVxZndV1vcCYQwBg+U1PkWl04TD0Jg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>  
    <script>
    document.addEventListener('contextmenu', event => event.preventDefault());

    // draw the pattern of the selected bug on the bug-color-canvas
    function drawBugPatternCanvas() {
        let canvas = document.getElementById("bug-pattern-canvas");
        let ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);        
        let bug = farm.colony[selectedBug];
        let pattern = bug.appearance.pattern;
        let size = 50 / pattern.length;
        for (let i = 0; i < pattern.length; i++) {
            for (let j = 0; j < pattern[i].length; j++) {
                if (pattern[i][j] === 0) {
                    ctx.fillStyle = bug.color;
                } else {
                    ctx.fillStyle = "black";
                }
                ctx.fillRect(j*size, i*size, size, size);
            }
        }
    }

    function sellABug() {
        if (farm.colony.length > 1 && selectedBug != -1) {
            farm.colony.splice(selectedBug, 1);
            selectedBug = -1;
        }
    }

    function plan() {        
        const petalNumber = document.getElementById("petal-number").value * 1;

        const pistilColor = document.getElementById("pistil-color").value;
        const pistilSize = document.getElementById("pistil-size").value * 1;
        
        const petalColor = document.getElementById("petal-color").value;
        const petalSize = document.getElementById("petal-size").value * 1;

        let flower = new Flower(farm.x + 10 + Math.random() * (farm.width - 20), farm.y + 10 + Math.random() * (farm.height - 20), pistilSize, pistilColor, petalSize, petalColor, petalNumber);
        farm.addObject(flower);
    }

    function removeFlower() {
        if (selectedFlower != -1) {
            farm.objects.splice(selectedFlower, 1);
            selectedFlower = -1;
        }
    }   
    </script>
</body>
</html>